"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const UserLoginValidator_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Validators/UserLoginValidator"));
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
class AuthController {
    async login({ request, response, auth }) {
        const { id, password } = await request.validate(new UserLoginValidator_1.default());
        const token = await auth.attempt(id, password);
        const student = await User_1.default.query().has('student').preload('student').where('id', id).first();
        if (student) {
            response.status(200).json({ token, profile: student, type: 'student' });
        }
        else {
            const specialist = await User_1.default.query().has('specialist').preload('specialist').where('id', id).first();
            if (specialist) {
                response.status(200).json({ token, profile: specialist, type: 'specialist' });
            }
            else {
                response.status(401).json({ message: 'could not login, wrong credentials' });
            }
        }
    }
}
exports.default = AuthController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0aENvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBdXRoQ29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLGlIQUFtRTtBQUNuRSxpRkFBbUM7QUFFbkMsTUFBcUIsY0FBYztJQUN4QixLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQXVCO1FBQy9ELE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEdBQUcsTUFBTSxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksNEJBQWtCLEVBQUUsQ0FBQyxDQUFBO1FBQ3pFLE1BQU0sS0FBSyxHQUFHLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDOUMsTUFBTSxPQUFPLEdBQUcsTUFBTSxjQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQzVGLElBQUksT0FBTyxFQUFFO1lBQ1QsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQTtTQUMxRTthQUFNO1lBQ0gsTUFBTSxVQUFVLEdBQUcsTUFBTSxjQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFBO1lBQ3JHLElBQUksVUFBVSxFQUFFO2dCQUNaLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUE7YUFDaEY7aUJBQU07Z0JBQ0gsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsb0NBQW9DLEVBQUMsQ0FBQyxDQUFBO2FBQzlFO1NBQ0o7SUFDTCxDQUFDO0NBQ0o7QUFoQkQsaUNBZ0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENvbnRleHRDb250cmFjdCB9IGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvSHR0cENvbnRleHQnXHJcbmltcG9ydCBVc2VyTG9naW5WYWxpZGF0b3IgZnJvbSBcIkFwcC9WYWxpZGF0b3JzL1VzZXJMb2dpblZhbGlkYXRvclwiO1xyXG5pbXBvcnQgVXNlciBmcm9tIFwiQXBwL01vZGVscy9Vc2VyXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRoQ29udHJvbGxlciB7XHJcbiAgICBwdWJsaWMgYXN5bmMgbG9naW4oeyByZXF1ZXN0LCByZXNwb25zZSwgYXV0aCB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgICAgY29uc3QgeyBpZCwgcGFzc3dvcmQgfSA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUobmV3IFVzZXJMb2dpblZhbGlkYXRvcigpKVxyXG4gICAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgYXV0aC5hdHRlbXB0KGlkLCBwYXNzd29yZClcclxuICAgICAgICBjb25zdCBzdHVkZW50ID0gYXdhaXQgVXNlci5xdWVyeSgpLmhhcygnc3R1ZGVudCcpLnByZWxvYWQoJ3N0dWRlbnQnKS53aGVyZSgnaWQnLCBpZCkuZmlyc3QoKVxyXG4gICAgICAgIGlmIChzdHVkZW50KSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oeyB0b2tlbiwgcHJvZmlsZTogc3R1ZGVudCwgdHlwZTogJ3N0dWRlbnQnIH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3Qgc3BlY2lhbGlzdCA9IGF3YWl0IFVzZXIucXVlcnkoKS5oYXMoJ3NwZWNpYWxpc3QnKS5wcmVsb2FkKCdzcGVjaWFsaXN0Jykud2hlcmUoJ2lkJywgaWQpLmZpcnN0KClcclxuICAgICAgICAgICAgaWYgKHNwZWNpYWxpc3QpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oeyB0b2tlbiwgcHJvZmlsZTogc3BlY2lhbGlzdCwgdHlwZTogJ3NwZWNpYWxpc3QnIH0pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZS5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ2NvdWxkIG5vdCBsb2dpbiwgd3JvbmcgY3JlZGVudGlhbHMnfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=